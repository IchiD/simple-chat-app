# Database Seeders

チャットアプリケーションのテストデータを生成するための seeder パッケージです。

## 📦 含まれる Seeder

### 1. `UserSeeder`

多様な状態のユーザーを 25 人作成します：

-   **アクティブユーザー**: 10 人（認証済み、バン・削除なし）
-   **新規登録未確認ユーザー**: 5 人（認証メール送信後、未確認）
-   **確認期限切れユーザー**: 3 人（認証期限が過ぎたユーザー）
-   **バンされたユーザー**: 2 人（管理者によりバン）
-   **削除されたユーザー**: 2 人（管理者により削除）
-   **特定テストユーザー**: 3 人（テスト用固定アカウント）

### 2. `FriendshipSeeder`

友達関係を約 18 組作成します：

-   **承認済み**: 10 組（お互いに友達）
-   **申請中**: 5 組（一方が申請、相手が未回答）
-   **拒否**: 3 組（申請が拒否された関係）

### 3. `ChatRoomSeeder`

チャットルームを作成します：

-   **メンバーチャット**: 友達同士の 1 対 1 チャット（グループメンバー間）
-   **フレンドチャット**: 友達同士の 1 対 1 チャット（友達関係）
-   **グループチャット**: 複数人が参加するグループチャット
    -   開発チーム（5 人）
    -   趣味の会（4 人）
    -   勉強会（6 人）
    -   お疲れ様チャット（3 人）
    -   各グループには必ず 1 人のオーナーが存在
    -   オーナーは課金プラン（standard または premium）
-   **サポートチャット**: ユーザーとサポート担当者間のチャット（最大 8 個）

### 4. `MessageSeeder`

リアルなメッセージを作成します：

-   **1 対 1 チャット**: 5-15 件のメッセージ
-   **グループチャット**: 15-30 件のメッセージ
-   **管理者メッセージ**: 30%の確率で各チャットに追加
-   **時系列**: 過去 1-7 日間にランダムに配置

### 5. `ComprehensiveSeeder`

上記全ての seeder を適切な順序で実行し、統計情報を表示します。

## 🚀 使用方法

### 基本的な実行

```bash
# 包括的なテストデータを作成
php artisan seed:comprehensive

# データベースをリフレッシュしてから作成
php artisan seed:comprehensive --fresh

# 個別のseederを実行
php artisan db:seed --class=UserSeeder
php artisan db:seed --class=FriendshipSeeder
php artisan db:seed --class=ChatRoomSeeder
php artisan db:seed --class=MessageSeeder
```

### 標準の DatabaseSeeder を使用

```bash
# 基本的なテストデータ（軽量）
php artisan db:seed

# 包括的なテストデータ（DatabaseSeeder.phpを編集して有効化）
# $this->call(ComprehensiveSeeder::class); のコメントアウトを解除
php artisan db:seed
```

## 🧪 テスト用アカウント

固定のテストアカウントが作成されます：

| メールアドレス        | ユーザー名 | 状態       | パスワード |
| --------------------- | ---------- | ---------- | ---------- |
| `active@example.com`  | 田中太郎   | アクティブ | `password` |
| `newuser@example.com` | 佐藤花子   | 未認証     | `password` |
| `banned@example.com`  | 鈴木一郎   | バン済み   | `password` |

## 📊 データ統計

ComprehensiveSeeder を実行すると以下のような統計が表示されます：

```
📊 作成されたデータの概要:
────────────────────────────────
👥 ユーザー: 25人
   ├─ アクティブ: 13人
   ├─ 未確認: 8人
   ├─ バン済み: 2人
   └─ 削除済み: 2人
🤝 友達関係: 18組
   ├─ 承認済み: 10組
   ├─ 申請中: 5組
   └─ 拒否: 3組
💬 チャットルーム: 22個
   ├─ メンバーチャット: 5個
   ├─ フレンドチャット: 5個
   ├─ グループチャット: 4個
   └─ サポートチャット: 8個
📝 メッセージ: 180件
   ├─ ユーザーメッセージ: 176件
   └─ 管理者メッセージ: 4件
💳 ユーザープラン:
   ├─ 無料プラン: 21人
   ├─ スタンダードプラン: 2人
   └─ プレミアムプラン: 2人
👑 グループオーナー: 4人
   ├─ スタンダードプラン: 2人
   └─ プレミアムプラン: 2人
```

## 🔧 カスタマイズ

### ユーザー数の調整

`UserSeeder.php`でユーザー数を変更できます：

```php
// アクティブなユーザー群を20人に変更
$activeUsers = User::factory(20)->create([
    'is_verified' => true,
    // ...
]);
```

### メッセージ内容の追加

`MessageSeeder.php`で新しいメッセージパターンを追加：

```php
private function getGroupChatMessage(int $index): string
{
    $groupMessages = [
        // 既存のメッセージ
        '新しいメッセージパターン',
        // ...
    ];
    return $groupMessages[array_rand($groupMessages)];
}
```

### グループチャットの追加

`ChatRoomSeeder.php`で新しいグループを追加：

```php
$groupChats = [
    // 既存のグループ
    [
        'name' => '新しいグループ',
        'description' => 'グループの説明',
        'member_count' => 5
    ],
];
```

## ⚠️ 注意事項

1. **データの依存関係**: seeder は決められた順序で実行する必要があります

    - Admin → User → Friendship → ChatRoom → Message

2. **重複実行**: 同じ seeder を複数回実行すると重複データが作成される可能性があります

3. **データベースのリセット**: 完全にクリーンな状態から始めたい場合は `--fresh` オプションを使用してください

4. **パフォーマンス**: 大量のデータを作成するため、実行には数秒から数分かかることがあります

## 🐛 トラブルシューティング

### よくある問題

**問題**: 「友達関係を作成するには、最低 2 人のアクティブなユーザーが必要です」
**解決**: まず UserSeeder を実行してから FriendshipSeeder を実行してください

**問題**: メッセージが作成されない
**解決**: ChatRoomSeeder が正常に実行されているか確認してください

**問題**: グループチャットが作成されない
**解決**: アクティブなユーザーが少ない可能性があります。UserSeeder でアクティブユーザー数を増やしてください

### ログの確認

```bash
# Laravelのログを確認
tail -f storage/logs/laravel.log

# SQLクエリの確認（config/database.phpでDB_LOG_QUERIES=trueに設定）
```

## 🚀 本番環境での注意

-   これらの seeder は**開発・テスト環境専用**です
-   本番環境では絶対に実行しないでください
-   本番環境用の seeder が必要な場合は別途作成してください
