# LumoChat Backend

## サポートチャット機能について

### 概要
ユーザーと管理者間のサポートチャット機能が実装されています。

### 主な機能
- ユーザー登録時に自動的にサポートチャットルームが作成されます
- メッセージがない場合、ユーザー側の/chatページには表示されません
- 管理画面からは全てのユーザーのサポートチャットが確認・メッセージ送信可能です

### 実装詳細

#### 自動作成機能
- 通常登録: `AuthService::register()` でユーザー作成後にサポートチャットルーム作成
- Google認証: `GoogleAuthController::handleGoogleCallback()` で新規ユーザー作成時に作成
- ユーザー復元時: 削除されたユーザーの復元時にもサポートチャットルーム確認・作成

#### 表示条件
- ユーザー側: メッセージがある場合のみ表示（`ConversationsController::index()`）
- 管理画面: 全てのサポートチャットルームが表示（`AdminDashboardController::supportConversations()`）

#### 既存ユーザー対応
既存ユーザーのサポートチャットルーム作成コマンド:
```bash
php artisan support:create-chat-rooms
```

## その他の機能

このプロジェクトはLaravelベースのチャットアプリケーションです。

### 主な機能
- ユーザー認証（通常登録・Google認証）
- 友達機能
- 1対1チャット
- グループチャット
- サポートチャット
- 管理画面

### 認証方式
API には Laravel Sanctum を使用したトークン認証を採用しています。
ログインや登録が完了するとアクセストークンが発行され、
フロントエンドは `Authorization: Bearer <token>` ヘッダを付与して API を呼び出します。

### セットアップ
1. 依存関係をインストール
2. 環境変数を設定
3. データベースマイグレーション実行
4. アプリケーション起動

# プロジェクトの立ち上げ

以下のコマンドでプロジェクトを起動します。

```bash
sail up -d
```

## キューワーカーの起動

キューワーカーを以下のコマンドで起動します。

```bash
sail artisan queue:work
```

## 外部トークンクリーンアップ

期限切れの外部 API トークンを削除するコマンドです。

```bash
sail artisan tokens:cleanup
```
